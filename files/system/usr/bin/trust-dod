#!/usr/bin/env bash
set -euo pipefail

VERSION="1.3"

usage() {
  cat <<'EOF'
Usage: trust-dod [--help] [--version]

Shows DoD-related CA entries in the system trust store.

EOF
}

case "${1:-}" in
  -h|--help) usage; exit 0 ;;
  --version) printf '%s\n' "$VERSION"; exit 0 ;;
esac

# shellcheck source=lib.sh
source /usr/lib/outpost/lib.sh

hdr "DoD trust anchors"
dim "Listing CA anchors related to DoD PKI."
printf '\n'

matches="$(trust list --filter=ca-anchors 2>/dev/null | grep -Ei 'dod' || true)"

if [[ -n "$matches" ]]; then
  box <<< "$matches"
  printf '\n'
  line "$(ok)" "Matching trust anchors found"
  exit 0
fi

line "$(warn)" "No DoD-related trust anchors found"
exit 1
